# =========================================================================== #
# Pipeline
# =========================================================================== #
paths:
  pype: "/Users/stefan/Dropbox/Data/VISIONS/DR1/raw/vircampype/"
  calibrated: "/Users/stefan/Dropbox/Data/VISIONS/DR1/raw/vircampype/calibrated/"

# =========================================================================== #
# Data and instrument
# =========================================================================== #
instrument:
  layout: [4, 4]

data:
  dim_x: 2048
  dim_y: 2048
  n_detectors: 16
  saturate: [33000, 32000, 33000, 32000,
             24000, 24000, 35000, 33000,
             35000, 35000, 37000, 34000,
             33000, 35000, 34000, 34000]

keywords:
  object: "OBJECT"
  filter: "HIERARCH ESO INS FILT1 NAME"
  type: "HIERARCH ESO DPR TYPE"
  category: "HIERARCH ESO DPR CATG"
  dit: "HIERARCH ESO DET DIT"
  ndit: "HIERARCH ESO DET NDIT"
  date_mjd: "MJD-OBS"
  date_ut: "DATE-OBS"
  gain: "GAIN"
  rdnoise: "RDNOISE"
  saturate: "SATURATE"

# =========================================================================== #
# Calibration
# =========================================================================== #
bpm:
  max_lag: 1
  abs_lo: 0.1
  abs_hi: 20000
  rel_lo: 0.96
  rel_hi: 1.04
  kappa: 4
  ikappa: 1
  frac: 0.2
  collapse_metric: "median"

dark:
  max_lag: 1
  mask_min: False
  mask_max: False
  kappa: 3
  ikappa: 1
  collapse_metric: "mean"

flat:
  max_lag: 1
  mask_min: False
  mask_max: False
  rel_lo: 0.5
  rel_hi: 1.5
  kappa: 3
  ikappa: 1
  collapse_metric: "weighted"

weight:
  mask_abs_max: 1.5
  mask_abs_min: 0.5
  mask_rel_max: 1.3
  mask_rel_min: 0.7

sky:
  mix_science: True                 # This is not yet used
  window: 30                        # Window in minutes around which sky images are created
  n_min: 5                          # Minimum number of images to merge to an offset image
  mask_min: False
  mask_max: True
  kappa: 3
  ikappa: 1
  mask_sources: True
  mask_sources_thresh: 5
  mask_sources_min_area: 3
  mask_sources_max_area: 250000     # 500 x 500 pix
  background_mesh_size: 256
  background_mesh_filter_size: 3
  collapse_metric: "median"
  mode: "background"

gain:
  max_lag: 1

linearity:
  order: 2
  max_lag: 1

cosmetics:
  interpolate_nan: True
#  mask_cosmics: True
  max_bad_neighbors: 3
  destripe: True
  destripe_axis: 2
  destripe_method: "median"

master:
  max_lag_bpm: 7                    # Maximum time difference to MasterBPM in days
  max_lag_dark: 7                   # Maximum time difference to MasterDark in days
  max_lag_flat: 7                   # Maximum time difference to MasterFlat in days
  max_lag_sky: 15                   # Maximum time difference to MasterSky in minutes (!)
  max_lag_gain: 7                   # Maximum time difference to MasterGain in days
  max_lag_weight: 7                 # Maximum time difference to MasterWright in days
  max_lag_linearity: 7              # Maximum time difference to MasterLinearity in days

misc:
  silent:  False
  overwrite:  False
  qc_plots:  True
  n_threads: 8
  fix_vircam_header: True
  reset_wcs: True

# =========================================================================== #
# Astrometry
# =========================================================================== #
astrometry:
  catalog: 2mass


# =========================================================================== #
# Photometry
# =========================================================================== #
photometry:
  reference: 2mass
  mag_limits_ref: 12,15
  distance_groups: 1
  margin: 0.1
  apcor_diam_eval: 0.3,0.4,0.5,0.6,0.8,1.0,1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0,5.5,6.0,7.0,8.0,9.0,10.0,12.0,14.0,16.0,18.0,20.0
  apcor_diam_save: 2.0,3.0,6.0,9.0,12.0
  apcor_func: moffat                # Function for aperture correction fitting
  apcor_image_scale: 0.2            # Scale factor for aperture correction output image


# =========================================================================== #
# Astromatic
# =========================================================================== #
astromatic:
  bin_sex: sex
  bin_scamp: scamp
  bin_swarp: swarp
  pixel_scale: 0.33333333333333